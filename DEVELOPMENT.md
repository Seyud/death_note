# 🚀 开发文档

## 📋 项目概述

🔧 **Death Note** 是一个基于《死亡笔记》动漫IP设计的Rust异步系统工具，以死神琉克(Ryuk)和死亡笔记系统为核心概念，实现了多平台用户身份识别、黑名单管理和决策制导功能。项目采用完全异步架构，专注于Android平台的数据提取和分析，使用Tokio异步运行时实现高并发性能。

## 🏗️ 项目架构

### 🔑 核心概念

基于《死亡笔记》的核心设定：
- **死亡笔记** → 黑名单系统：记录应被审判的灵魂名单，实现目标检查和记录功能
- **死神之眼** → 识别系统：能够看透人类真名和剩余寿命的特殊视觉，并行识别多平台用户
- **琉克** → 制导系统：因厌倦死神界而将死亡笔记丢弃至人间的观察者，智能决策和异步审判

### 🎯 核心模块

#### 1. 👁️‍🗨️ **死神之眼系统** (`identification` module) 
**异步并行身份识别模块**

- **📱 CoolapkShinigamiEye** (`coolapk_identifier.rs`) - 异步酷安用户识别
- **✈️ TelegramShinigamiEye** (`telegram_identifier.rs`) - 异步Telegram用户识别
- **💬 QQShinigamiEye** (`qq_identifier.rs`) - 异步QQ用户识别
- **👁️‍🗨️ ShinigamiEyeManager** (`manager.rs`) - 统一协调所有识别器，支持超时控制和并发执行
- **📅 LifespanCalculator** (`lifespan_calculator.rs`) - 寿命计算器，基于用户ID和黑名单状态计算寿命
- **🔧 ShinigamiEye Traits** (`traits.rs`) - 定义识别器通用接口和结果抽象

#### 2. 📖 **死亡笔记系统** (`blacklist` module)
**黑名单管理和审判记录**

- **📖 DeathNote** (`manager.rs`) - 主要黑名单管理器，提供各平台目标检查和记录功能
- **📖 CoolapkBlacklist** (`coolapk.rs`) - 酷安平台黑名单数据
- **📖 QQBlacklist** (`qq.rs`) - QQ平台黑名单数据  
- **📖 TelegramBlacklist** (`telegram.rs`) - Telegram平台黑名单数据

#### 3. 😈 **琉克制导系统** (`guidance` module)
**基于异步识别结果的智能决策系统**

- **🧠 RyukGuidanceSystem** (`guidance_async.rs`) - 模拟琉克性格的智能决策，包含苹果机制和厌倦值
- **🍎 苹果系统** - 基于发现目标数量的动态苹果消费机制
- **⚰️ AndroidPartitionOperator** (`partition_ops.rs`) - 
- **⚰️ 异步灵魂收割** - 

## 🔄 程序运行顺序

### 🚀 异步执行流程

```
📓 死亡笔记系统启动 (Tokio异步运行时)
    ↓
😈 Ryuk: 终于有点有趣的事情了...
    ↓ 
🎯 创建死神之眼管理器 (ShinigamiEyeManager)
    ├── � 注册酷安死神之眼识别器
    ├── � 注册QQ死神之眼识别器  
    ├── ✈️ 注册Telegram死神之眼识别器
    └── ⏰ 设置6秒死神之眼持续时间限制
    ↓
😈 创建琉克制导系统 (RyukGuidanceSystem)
    ├── 🔍 检测Android设备环境
    ├── 🍎 初始化苹果计数器 (0个)
    ├── 😴 设置初始厌倦值 (100)
    └── 📖 关联死亡笔记实例
    ↓
👁️‍🗨️ 并行激活所有死神之眼 (activate_all)
    ├── 📱 酷安死神之眼 (异步扫描)
    │   ├── 🔍 扫描 
    │   ├── 🧪 扫描  (调试模式)
    │   └── 👤 提取用户UID并计算寿命
    ├── 💬 QQ死神之眼 (异步扫描)
    │   ├── 🔍 扫描 
    │   ├── 🧪 扫描  (调试模式)
    │   └── 👤 提取QQ号并计算寿命
    ├── ✈️ Telegram死神之眼 (异步扫描)
    │   ├── 🔍 扫描 
    │   ├── 🧪 扫描  (调试模式)
    │   └── � 提取用户ID并计算寿命
    └── ⏰ 所有识别器并发执行，6秒超时控制
    ↓
� 收集并显示死神之眼观察结果
    ├── 📈 统计各平台发现的目标数量
    ├── 👤 显示每个目标的详细信息 (名称/寿命/黑名单状态)
    └── 📋 汇总总计发现的目标数
    ↓
🧠 琉克审判决策 (ryuk_judgment)
    ├── 🔍 检查每个识别结果是否在死亡笔记上
    ├── � 收集所有黑名单目标信息
    ├── 🍎 根据黑名单目标数量消费苹果 (每个目标1个苹果)
    ├── � 调整琉克的厌倦值
    └── 🎯 生成审判决策 (Execute/Skip)
    ↓
⚰️ 执行死神审判 (execute_shinigami_judgment)
    ├── 🚨 有黑名单目标 → 执行灵魂收割仪式
    │   ├── 🔮 启动异步灵魂收割仪式
    │   ├── ⚰️ 并行收割灵魂 (666ms延迟)
    │   ├── ⚰️ 并行收割灵魂 (666ms延迟)
    │   ├── 📖 死亡笔记记录每次收割操作
    │   └── 😈 琉克发表审判感言
    └── ✅ 无黑名单目标 → 琉克选择旁观
    ↓
📊 显示最终审判结果
    ├── 💀 成功收割的灵魂列表
    ├── 💨 逃脱的灵魂及原因
    ├── 📈 被审判的目标总数
    └── 🍎 琉克的苹果消费情况
    ↓
📓 死亡笔记系统运行结束
👁️‍🗨️ 死神之眼已关闭
```

### 🌟 异步并行技术特性

- **⚡ Tokio异步运行时**: 并行执行所有识别器
- **⏰ 超时机制**: 确保单个识别器不会阻塞整体流程
- **🔧 trait抽象**: 支持动态识别器注册和扩展
- **💪 错误隔离**: 单个识别器失败不影响其他识别器的执行
- **🛡️ 内存安全**: 实现线程安全的共享访问
- **� 多态支持**: 统一处理不同类型的识别结果

### ⚙️ 琉克智能特性

- **🍎 苹果计数系统**: 实现线程安全的苹果计数，每发现1个黑名单目标消费1个苹果
- **😴 动态厌倦机制**: 基于发现结果调整厌倦值，影响琉克的行为表现
- **😈 性格模拟**: 根据发现数量和厌倦值生成不同的琉克对话
- **⚰️ 异步收割**: 模拟666ms的死神收割仪式延迟
- **📖 审判记录**: 每次灵魂收割都会在死亡笔记上留下记录

## 🎭 设计理念

本项目采用拟人化的设计理念，将技术系统包装成动漫角色，使得：
- **用户体验**: 更具趣味性和故事性的交互体验
- **系统理解**: 通过动漫设定降低复杂异步系统的理解门槛
- **扩展性**: 新功能可以轻松对应新的死神角色和能力
- **维护性**: 清晰的模块划分和职责分离，易于代码维护